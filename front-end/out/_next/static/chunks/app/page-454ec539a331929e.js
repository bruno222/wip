(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4822:function(e,t,n){Promise.resolve().then(n.bind(n,4358))},4358:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var c=n(3827),s=n(4090);function o(e){let{sender:t,text:n}=e;return(0,c.jsxs)("div",{className:"chat-message mb-4",children:[(0,c.jsx)("h4",{className:"chat-author font-bold text-zinc-950",children:t}),(0,c.jsx)("p",{className:"chat-text text-zinc-950",children:n})]})}function r(){let[e,t]=(0,s.useState)([]),[n,o]=(0,s.useState)([]),r={},[a,i]=(0,s.useState)("disconnected"),[d,u]=(0,s.useState)({1:void 0,2:void 0}),[f,g]=(0,s.useState)(""),h=(0,s.useRef)(null);function x(e,n){(1==+e?t:o)(e=>{if(console.log("@@@ prevMessages",e),e.length>0){let{interactionId:t,text:c}=e[e.length-1];if(t&&t===n.interactionId)return[...e.slice(0,-1),{...n,text:"".concat(c," ").concat(n.text.replace("•","").trim())}]}return[...e,{...n,text:n.text.replace("•","").trim()}]})}let m=e=>function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",c=d[e];h.current&&h.current.readyState===WebSocket.OPEN&&h.current.send(JSON.stringify({type:t,text:n,CallSid:c})),"hijack-call"===t&&x(e,{sender:"System",text:"Forwarding the call to you..."}),"new-msg-from-supervisor"===t&&""!==n&&g(t=>t.replace("|".concat(e,"|"),"").replace("||","|"))};return(0,s.useEffect)(()=>{console.log("ws connecting...");let e=new WebSocket("ws://localhost:8080");return h.current=e,e.onmessage=e=>{let t=JSON.parse(e.data);if("new-msg"===t.type){console.log("@@@ new-msg",t);let e=r[t.CallSid];console.log("@@@ currentCall",e,r);let n=e?e.callId:0;if(!n){console.warn("callId is null");return}x(n,t);return}if("call-started"===t.type){let{CallSid:e,From:n,callId:c}=t;r[e]={CallSid:e,From:n,callId:c},u(t=>({...t,[c]:e})),x(c,{sender:"System",text:"Call started with ".concat(n)});return}if("call-ended"===t.type){let{CallSid:e,From:n,callId:c}=t;r[e]={CallSid:e,From:n,callId:c},u(e=>({...e,[c]:void 0})),x(c,{sender:"System",text:"Call with the Bot has ended."});return}if("front-end-connected"===t.type){console.log("@@@ front-end-connected"),i("connected"),m("0")("give-me-all-current-calls");return}if("raise-hand"===t.type){let{callId:e}=t;g(t=>"".concat(t,"|").concat(e,"|").replace("||","|"));return}},e.onclose=e=>{console.log("ws closed",e),i("disconnected")},e.onerror=e=>{console.error("Socket error",e),i("disconnected & error")},()=>{h.current&&h.current.close()}},[]),(0,c.jsxs)("div",{className:"flex flex-row h-screen",children:[(0,c.jsx)(l,{messages:e,color:"red",status:a,sendCommandSocket:m("1"),CallSid:d[1],isHandRaised:f.includes("1")}),(0,c.jsx)(l,{messages:n,color:"blue",status:a,sendCommandSocket:m("2"),CallSid:d[2],isHandRaised:f.includes("2")})]})}function l(e){let{messages:t,color:n,status:r,sendCommandSocket:l,CallSid:a,isHandRaised:i}=e,[d,u]=(0,s.useState)("connecting..."),[f,g]=(0,s.useState)("connecting...");"connected"!==r||a||(r="waiting for a call...");let h="connected"===r?"":"bg-gray-100",x="connected"!==r;function m(){l("new-msg-from-supervisor",d),u("")}return(0,s.useEffect)(()=>{console.log("status changed",r),u(""),"connected"===r?g("Send a hint"):g(r)},[r]),(0,c.jsxs)("div",{className:"flex-1 bg-indigo-100 flex flex-col justify-between p-4 space-y-4",children:[(0,c.jsx)("div",{id:"chat",className:"p-4 rounded shadow overflow-auto bg-indigo-200",children:t.map((e,t)=>(0,c.jsx)(o,{...e},t))}),function(){if(i)return(0,c.jsx)("div",{className:"flex-1 bg-indigo-100 flex flex-col justify-between p-4 space-y-4 items-center",children:(0,c.jsx)("img",{src:"/raise-hand.png",width:"200px"})})}(),(0,c.jsxs)("div",{id:"textbox",className:"mt-auto flex justify-end items-center space-x-2 bg-".concat(n,"-600 p-2 rounded-lg"),children:[(0,c.jsx)("textarea",{placeholder:f,className:"flex-1 ".concat(h," rounded-lg"),rows:2,value:d,onChange:e=>u(e.target.value),onKeyDown:function(e){"Enter"===e.key&&(m(),e.preventDefault())},disabled:x}),(0,c.jsx)("button",{className:"px-4 py-2 bg-red-500 text-white rounded shadow-md hover:bg-red-600 transition-colors duration-200",onClick:m,children:"Send"}),(0,c.jsx)("button",{className:"px-4 py-2 bg-green-500 text-white rounded shadow-md hover:bg-green-600 transition-colors duration-200",onClick:function(){window.parent&&window.parent.postMessage({type:"FLEX_CHANGE_ACTIVITY_TO_AVAILABLE"},"*"),l("hijack-call")},children:"Hijack"})]})]})}}},function(e){e.O(0,[971,69,744],function(){return e(e.s=4822)}),_N_E=e.O()}]);